<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>インフルエンザ出席停止期間計算機</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for in-browser JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      body {
        font-family: 'Zen Maru Gothic', sans-serif;
        background-color: #f0f9ff;
      }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-presets="env,react">
      const { useState, useEffect } = React;

      // --- ICONS (Lucide replacements) ---
      const IconBase = ({ children, className = "", ...props }) => (
        <svg 
          xmlns="http://www.w3.org/2000/svg" 
          width="24" height="24" viewBox="0 0 24 24" 
          fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" 
          className={className} {...props}
        >
          {children}
        </svg>
      );

      const ShieldCheck = (props) => (
        <IconBase {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" /><path d="m9 12 2 2 4-4" /></IconBase>
      );
      const Info = (props) => (
        <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></IconBase>
      );
      const School = (props) => (
        <IconBase {...props}><path d="m4 6 8-4 8 4"/><path d="m18 10 4 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-8l4-2"/><path d="M14 22v-4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v4"/><path d="M18 5v17"/><path d="M6 5v17"/><circle cx="12" cy="9" r="2"/></IconBase>
      );
      const Baby = (props) => (
        <IconBase {...props}><path d="M9 12h.01"/><path d="M15 12h.01"/><path d="M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5"/><path d="M19 6.3a9 9 0 0 1 1.8 3.9 2 2 0 0 1 0 3.8 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.8A9 9 0 0 1 12 3a9 9 0 0 1 7 3.3z"/></IconBase>
      );
      const Calendar = (props) => (
        <IconBase {...props}><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></IconBase>
      );
      const AlertTriangle = (props) => (
        <IconBase {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></IconBase>
      );
      const CheckCircle = (props) => (
        <IconBase {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m22 4-11 11.01L7.56 12.01"/></IconBase>
      );
      const ThermometerSun = (props) => (
        <IconBase {...props}><path d="M12 9a4 4 0 0 0-2 7.5"/><path d="M12 3v2"/><path d="M6.6 18.4 5.2 19.8"/><path d="M20 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/><path d="M4 13H2"/><path d="M6.34 7.34 4.93 5.93"/></IconBase>
      );
      const Thermometer = (props) => (
        <IconBase {...props}><path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/></IconBase>
      );

      // --- LOGIC ---

      const StudentCategory = {
        SCHOOL: 'SCHOOL',
        PRESCHOOL: 'PRESCHOOL'
      };

      const addDays = (date, days) => {
        const result = new Date(date);
        result.setDate(result.getDate() + days);
        return result;
      };

      const getDiffDays = (date1, date2) => {
        const oneDay = 24 * 60 * 60 * 1000;
        const d1 = new Date(date1.getFullYear(), date1.getMonth(), date1.getDate());
        const d2 = new Date(date2.getFullYear(), date2.getMonth(), date2.getDate());
        return Math.round((d1.getTime() - d2.getTime()) / oneDay);
      };

      const formatDateJP = (date) => {
        const days = ['日', '月', '火', '水', '木', '金', '土'];
        return `${date.getMonth() + 1}月${date.getDate()}日(${days[date.getDay()]})`;
      };

      const calculateReturnDate = (onsetDateStr, feverDateStr, category) => {
        if (!onsetDateStr) return null;

        const onsetDate = new Date(onsetDateStr);
        const minDateFromOnset = addDays(onsetDate, 5);

        let resultDate = minDateFromOnset;
        let reason = "発症した後5日を経過";
        let feverResolvedDate = null;

        if (feverDateStr) {
          feverResolvedDate = new Date(feverDateStr);
          const daysAfterFever = category === StudentCategory.SCHOOL ? 2 : 3;
          const minDateFromFever = addDays(feverResolvedDate, daysAfterFever);

          if (minDateFromFever > minDateFromOnset) {
            resultDate = minDateFromFever;
            reason = category === StudentCategory.SCHOOL 
              ? "解熱した後2日を経過" 
              : "解熱した後3日を経過";
          }
        }

        const lastWaitDayFromOnset = addDays(onsetDate, 5);
        let lastWaitDayTotal = lastWaitDayFromOnset;

        if (feverDateStr) {
          feverResolvedDate = new Date(feverDateStr);
          const daysWait = category === StudentCategory.SCHOOL ? 2 : 3;
          const lastWaitDayFromFever = addDays(feverResolvedDate, daysWait);
          
          if (lastWaitDayFromFever > lastWaitDayTotal) {
            lastWaitDayTotal = lastWaitDayFromFever;
          }
        }

        const returnDate = addDays(lastWaitDayTotal, 1);

        return {
          canReturnDate: returnDate,
          reason,
          daysFromOnset: getDiffDays(returnDate, onsetDate),
          daysFromFever: feverResolvedDate ? getDiffDays(returnDate, feverResolvedDate) : 0,
          isCriterionAMet: true,
          isCriterionBMet: !!feverDateStr
        };
      };

      const generateTimeline = (onsetDate, feverDate, returnDate, category) => {
        const days = [];
        const startDate = new Date(onsetDate);
        const endDate = new Date(returnDate);
        
        const current = new Date(startDate);
        while (current <= endDate) {
          const dayDiffOnset = getDiffDays(current, onsetDate);
          const dayDiffFever = feverDate ? getDiffDays(current, feverDate) : null;
          
          const waitOnset = 5;
          const waitFever = category === StudentCategory.SCHOOL ? 2 : 3;
          
          const isWaitOnsetFinished = dayDiffOnset > waitOnset;
          const isWaitFeverFinished = dayDiffFever !== null ? dayDiffFever > waitFever : false;
          
          let status = 'wait';
          if (feverDate) {
              if (isWaitOnsetFinished && isWaitFeverFinished) status = 'ok';
          } else {
              if (isWaitOnsetFinished) status = 'ok'; 
          }

          days.push({
            date: new Date(current),
            dayNumFromOnset: dayDiffOnset,
            dayNumFromFever: dayDiffFever,
            status: status,
            isOnset: dayDiffOnset === 0,
            isFeverResolved: dayDiffFever === 0,
            isReturnDate: getDiffDays(current, returnDate) === 0
          });
          
          current.setDate(current.getDate() + 1);
        }
        return days;
      };

      // --- COMPONENTS ---

      const Timeline = ({ days, category }) => {
        const waitFeverLimit = category === StudentCategory.SCHOOL ? 2 : 3;

        return (
          <div className="w-full mt-6 bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <div className="bg-slate-50 px-4 py-3 border-b border-slate-200 flex justify-between items-center">
              <h3 className="font-bold text-slate-700">経過タイムライン</h3>
              <span className="text-xs text-slate-500 bg-white px-2 py-1 rounded border">
                 0日目＝発生日
              </span>
            </div>
            
            <div className="flex flex-col divide-y divide-slate-100">
              {days.map((day) => {
                const isOk = day.status === 'ok';
                
                return (
                  <div 
                    key={day.date.toISOString()} 
                    className={`flex items-center p-3 sm:px-6 transition-colors ${
                      isOk ? 'bg-emerald-50/50' : 'bg-white'
                    } ${day.isReturnDate ? 'bg-emerald-100 ring-2 ring-inset ring-emerald-400' : ''}`}
                  >
                    <div className="flex-none w-24 sm:w-32">
                      <div className={`font-bold ${day.isReturnDate ? 'text-emerald-700 text-lg' : 'text-slate-700'}`}>
                        {formatDateJP(day.date)}
                      </div>
                      <div className="text-xs text-slate-500 mt-0.5">
                        {day.isReturnDate ? (
                           <span className="font-bold text-emerald-600">登校可能</span>
                        ) : (
                          <span>発症{day.dayNumFromOnset}日目</span>
                        )}
                      </div>
                    </div>

                    <div className="flex-1 px-2 sm:px-4 flex flex-col gap-1">
                      <div className="flex items-center gap-2">
                        <div className={`h-2.5 rounded-full flex-1 max-w-[120px] ${
                          day.dayNumFromOnset > 5 ? 'bg-emerald-400' : 'bg-rose-300'
                        }`}></div>
                        <span className="text-[10px] text-slate-400 min-w-[60px]">
                          {day.dayNumFromOnset > 5 ? '経過(5日超)' : `経過中(${day.dayNumFromOnset}/5)`}
                        </span>
                      </div>
                      
                      {day.dayNumFromFever !== null && (
                        <div className="flex items-center gap-2">
                          <div className={`h-2.5 rounded-full flex-1 max-w-[120px] ${
                            day.dayNumFromFever > waitFeverLimit ? 'bg-emerald-400' : 'bg-orange-300'
                          }`}></div>
                           <span className="text-[10px] text-slate-400 min-w-[60px]">
                              {day.dayNumFromFever > waitFeverLimit 
                                ? `経過(${waitFeverLimit}日超)` 
                                : `経過中(${day.dayNumFromFever >= 0 ? day.dayNumFromFever : '-'}/${waitFeverLimit})`
                              }
                           </span>
                        </div>
                      )}
                    </div>

                    <div className="flex-none w-8 flex flex-col items-center gap-1 justify-center">
                      {day.isOnset && (
                        <div className="relative group">
                          <ThermometerSun className="w-6 h-6 text-rose-500" />
                          <span className="absolute right-full mr-2 top-0 bg-rose-600 text-white text-[10px] px-1 rounded whitespace-nowrap hidden group-hover:block">発症日</span>
                        </div>
                      )}
                      {day.isFeverResolved && (
                        <div className="relative group">
                          <Thermometer className="w-6 h-6 text-blue-500" />
                          <span className="absolute right-full mr-2 top-0 bg-blue-600 text-white text-[10px] px-1 rounded whitespace-nowrap hidden group-hover:block">解熱日</span>
                        </div>
                      )}
                      {day.isReturnDate && (
                        <CheckCircle className="w-7 h-7 text-emerald-600" />
                      )}
                      {!day.isReturnDate && !day.isOnset && !day.isFeverResolved && (
                        <div className="w-2 h-2 rounded-full bg-slate-200"></div>
                      )}
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        );
      };

      const App = () => {
        const [category, setCategory] = useState(StudentCategory.SCHOOL);
        const [onsetDate, setOnsetDate] = useState('');
        const [feverDate, setFeverDate] = useState('');
        const [result, setResult] = useState(null);

        useEffect(() => {
          if (onsetDate) {
            const res = calculateReturnDate(onsetDate, feverDate, category);
            setResult(res);
          } else {
            setResult(null);
          }
        }, [onsetDate, feverDate, category]);

        const today = new Date().toISOString().split('T')[0];

        return (
          <div className="min-h-screen pb-12 px-4 sm:px-6 lg:px-8 max-w-3xl mx-auto">
            <header className="py-6 text-center">
              <div className="inline-flex items-center justify-center p-3 bg-teal-600 rounded-full shadow-lg mb-4">
                <ShieldCheck className="w-8 h-8 text-white" />
              </div>
              <h1 className="text-2xl sm:text-3xl font-bold text-slate-800">
                インフルエンザ<br className="sm:hidden" />出席停止期間計算機
              </h1>
              <p className="mt-2 text-slate-600 text-sm">
                発症日と解熱日を入力するだけで、最短の登校可能日を計算します。
              </p>
            </header>

            <section className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden mb-6">
              <div className="p-5 sm:p-8 space-y-8">
                
                <div>
                  <label className="block text-sm font-bold text-slate-700 mb-3 flex items-center gap-2">
                    <Info className="w-4 h-4 text-teal-500" />
                    1. お子様の区分
                  </label>
                  <div className="grid grid-cols-2 gap-4">
                    <button
                      onClick={() => setCategory(StudentCategory.SCHOOL)}
                      className={`relative flex flex-col items-center justify-center p-4 rounded-xl border-2 transition-all ${
                        category === StudentCategory.SCHOOL
                          ? 'border-teal-500 bg-teal-50 text-teal-800'
                          : 'border-slate-200 hover:border-slate-300 text-slate-500'
                      }`}
                    >
                      <School className={`w-8 h-8 mb-2 ${category === StudentCategory.SCHOOL ? 'text-teal-600' : 'text-slate-400'}`} />
                      <span className="font-bold">小学生以上</span>
                      <span className="text-[10px] mt-1 opacity-70">解熱後2日を経過</span>
                      {category === StudentCategory.SCHOOL && (
                        <div className="absolute top-2 right-2 w-3 h-3 bg-teal-500 rounded-full"></div>
                      )}
                    </button>

                    <button
                      onClick={() => setCategory(StudentCategory.PRESCHOOL)}
                      className={`relative flex flex-col items-center justify-center p-4 rounded-xl border-2 transition-all ${
                        category === StudentCategory.PRESCHOOL
                          ? 'border-teal-500 bg-teal-50 text-teal-800'
                          : 'border-slate-200 hover:border-slate-300 text-slate-500'
                      }`}
                    >
                      <Baby className={`w-8 h-8 mb-2 ${category === StudentCategory.PRESCHOOL ? 'text-teal-600' : 'text-slate-400'}`} />
                      <span className="font-bold">幼児（未就学児）</span>
                      <span className="text-[10px] mt-1 opacity-70">解熱後3日を経過</span>
                      {category === StudentCategory.PRESCHOOL && (
                        <div className="absolute top-2 right-2 w-3 h-3 bg-teal-500 rounded-full"></div>
                      )}
                    </button>
                  </div>
                </div>

                <div className="grid grid-cols-1 sm:grid-cols-2 gap-6">
                  <div>
                    <label className="block text-sm font-bold text-slate-700 mb-2 flex items-center gap-2">
                      <Calendar className="w-4 h-4 text-rose-500" />
                      2. 発症日 (0日目)
                    </label>
                    <input
                      type="date"
                      max={today}
                      value={onsetDate}
                      onChange={(e) => setOnsetDate(e.target.value)}
                      className="w-full p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-teal-500 focus:border-transparent outline-none text-lg"
                    />
                    <p className="text-xs text-slate-500 mt-2 bg-slate-50 p-2 rounded">
                      ※病院を受診した日ではなく、<strong>発熱などの症状が出始めた日</strong>を入力してください。
                    </p>
                  </div>

                  <div className={!onsetDate ? "opacity-50 pointer-events-none" : ""}>
                    <label className="block text-sm font-bold text-slate-700 mb-2 flex items-center gap-2">
                      <Calendar className="w-4 h-4 text-blue-500" />
                      3. 解熱日 (0日目)
                    </label>
                    <input
                      type="date"
                      min={onsetDate}
                      value={feverDate}
                      onChange={(e) => setFeverDate(e.target.value)}
                      className="w-full p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-teal-500 focus:border-transparent outline-none text-lg"
                    />
                    <p className="text-xs text-slate-500 mt-2 bg-slate-50 p-2 rounded">
                      ※薬を使わずに平熱に戻り、そのまま下がっていることを確認した日。まだの場合は空欄でOKです。
                    </p>
                  </div>
                </div>
              </div>
            </section>

            {result && onsetDate && (
              <section className="animate-in fade-in slide-in-from-bottom-4 duration-500">
                <div className={`rounded-2xl shadow-lg border-2 overflow-hidden ${feverDate ? 'bg-white border-emerald-500' : 'bg-amber-50 border-amber-300'}`}>
                  
                  <div className={`p-4 text-center text-white ${feverDate ? 'bg-emerald-500' : 'bg-amber-400'}`}>
                    <h2 className="font-bold text-lg">
                      {feverDate ? '最短登校可能日' : '解熱日が未定の場合の目安'}
                    </h2>
                  </div>

                  <div className="p-6 sm:p-10 text-center">
                    {!feverDate && (
                      <div className="flex items-center justify-center gap-2 text-amber-700 mb-4 bg-amber-100 p-3 rounded-lg text-sm">
                        <AlertTriangle className="w-5 h-5 flex-none" />
                        <span>解熱日が入力されていません。<br className="sm:hidden"/>解熱日によって期間が延びる可能性があります。</span>
                      </div>
                    )}

                    <p className="text-slate-500 text-sm mb-2">この日に登校再開できます</p>
                    <div className="text-4xl sm:text-5xl font-extrabold text-slate-800 tracking-tight">
                      {formatDateJP(result.canReturnDate)}
                    </div>
                    
                    <div className="mt-6 flex flex-wrap justify-center gap-2">
                       <div className="px-3 py-1 bg-rose-50 text-rose-700 rounded-full text-xs font-bold border border-rose-100">
                          発症から{result.daysFromOnset}日経過
                       </div>
                       {feverDate && (
                         <div className="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-bold border border-blue-100">
                            解熱から{result.daysFromFever}日経過
                         </div>
                       )}
                    </div>
                  </div>
                </div>

                <Timeline 
                  days={generateTimeline(
                    new Date(onsetDate), 
                    feverDate ? new Date(feverDate) : null, 
                    result.canReturnDate,
                    category
                  )} 
                  category={category} 
                />
              </section>
            )}

            <footer className="mt-12 text-slate-400 text-xs text-center pb-8">
              <div className="bg-slate-100 p-4 rounded-xl mx-auto max-w-2xl text-left">
                <p className="font-bold mb-2 flex items-center gap-2">
                  <AlertTriangle className="w-4 h-4" /> 免責事項・注意事項
                </p>
                <ul className="list-disc pl-4 space-y-1">
                  <li>本アプリの計算結果は「学校保健安全法」に基づく一般的な基準です。</li>
                  <li>登校再開の最終的な判断は、必ず<strong>医師、学校、またはお住まいの自治体の指示</strong>に従ってください。</li>
                  <li>「発症した後5日」とは、発症した日を0日目として翌日から数えて5日目までが出席停止期間となり、6日目が登校可能日となります。</li>
                  <li>入力されたデータは、お使いのブラウザ内でのみ処理され、外部サーバーへ送信・保存されることはありません。</li>
                </ul>
              </div>
            </footer>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>